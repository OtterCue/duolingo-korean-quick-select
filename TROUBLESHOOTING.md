# 🔧 키 입력 문제 해결 가이드

## 문제: 키보드 입력이 감지되지 않음

듀오링고가 키보드 이벤트를 먼저 가로채서 발생하는 문제입니다.

## ✅ 이번 버전에서 개선한 사항

### 1. **다중 이벤트 리스너 등록**
```javascript
// 6개의 이벤트 리스너를 다양한 레벨에 등록
window.addEventListener('keydown', handler, true);      // capture
document.addEventListener('keydown', handler, true);    // capture
document.body.addEventListener('keydown', handler, true); // capture
window.addEventListener('keydown', handler);            // bubble
document.addEventListener('keydown', handler);          // bubble
window.addEventListener('keypress', handler, true);     // keypress
```

### 2. **이벤트 완전 차단**
```javascript
event.preventDefault();           // 기본 동작 차단
event.stopPropagation();         // 상위로 전파 차단
event.stopImmediatePropagation(); // 같은 레벨 리스너 차단
return false;                     // 추가 차단
```

### 3. **더 빠른 실행**
- `run_at: "document_start"` → 페이지가 로드되기 전에 실행
- 듀오링고보다 먼저 이벤트 리스너 등록

### 4. **상세한 디버깅 로그**
- 모든 초성 키 입력을 감지하고 로그 출력
- 어느 단계에서 막히는지 정확히 파악 가능

## 🧪 테스트 방법

### 실제 듀오링고에서 테스트

1. 듀오링고 레슨 시작
2. 단어 선택 문제가 나올 때까지 진행
3. **F12** 키를 눌러 개발자 도구 열기
4. **Console** 탭 선택
5. 초성 입력하면서 로그 확인:

```
✅ 단어 은행 발견! 한글 빠른 선택 활성화됨
📝 한글 버튼 6개 발견: ["학과에서", "파티", "우리는", ...]
🔑 키 감지됨: "ㅇ", target: BODY
✅ "ㅇ" 입력 성공! - 현재: "ㅇ"
  "우리는" → 초성: "ㅇㄹㄴ"
  "여기" → 초성: "ㅇㄱ"
🎯 입력: "ㅇ", 매칭: 2개
```

### 중요: 포커스 위치

- ✅ 페이지의 **빈 공간**을 클릭한 상태에서 입력
- ❌ 입력창이나 버튼에 포커스가 있으면 안 됨

## 🔍 문제 진단

### 케이스 1: 아무 로그도 안 나옴
**원인**: 확장 프로그램이 로드되지 않음

**해결**:
1. `chrome://extensions/`에서 확장 프로그램 확인
2. "오류" 버튼이 있다면 클릭해서 확인
3. 페이지 새로고침 (Ctrl+R 또는 F5)
4. 확장 프로그램 다시 설치

### 케이스 2: "🔑 키 감지됨"만 나오고 멈춤
**원인**: 키는 감지되지만 조건에서 걸림

**확인사항**:
- `target: INPUT` 또는 `target: TEXTAREA`라고 나오나요?
  → 입력창에 포커스가 있어서 무시됨
  → 페이지의 빈 공간 클릭 후 다시 시도
  
- "❌ 단어 은행이 없어서 비활성화됨"이 나오나요?
  → 단어 선택 문제가 아님
  → 다른 문제로 넘어가거나 스킵

### 케이스 3: "✅ 입력 성공" 나오는데 버튼 안 하이라이트됨
**원인**: 버튼을 찾지 못함

**해결**:
1. F12 → Elements 탭
2. 단어 버튼 하나 우클릭 → Inspect
3. HTML 구조 확인:
   - `data-test="xxx-challenge-tap-token"` 있나요?
   - `lang="ko"` 속성 있나요?
4. 없다면 듀오링고 UI가 변경된 것 → 이슈 제보

### 케이스 4: 한영 전환이 안 되어있음
**증상**: 아무것도 안 일어남, 로그도 없음

**해결**: 
- 한글 입력 모드인지 확인
- **Shift 키를 눌러 한영 전환** (또는 한/영 키)
- 초성이 입력되도록 해야 함

## 💡 추가 팁

### 듀오링고 단축키와 충돌 방지
듀오링고 자체 단축키:
- `Enter`: 답 확인
- `Space`: 다음 문제
- `1, 2, 3, ...`: 선택지 선택

이것들과는 충돌하지 않도록 **한글 초성만** 사용합니다.

### 권장 워크플로우
1. 문제를 읽는다
2. 마우스나 손가락으로 영어 문장을 훑어본다
3. 필요한 단어의 초성을 떠올린다
4. 초성을 입력한다
   - 예: "We are here together" → "우리는" 필요 → `ㅇㄹ` 입력
5. 자동 선택되거나 파란색으로 하이라이트된 버튼 클릭

### 자주 사용하는 패턴
```
ㅇ + ㄹ = "우리는" (ㅇㄹㄴ)
ㄴ = "나는/너는" (ㄴㄴ)
ㅇ + ㄱ = "여기/이것" (ㅇㄱ)
ㄱ + ㅌ = "같이" (ㄱㅌ)
ㅇ + ㅅ = "있어요" (ㅇㅅㅇ)
```

## 🆘 그래도 안 되면

1. **이슈 리포트 남기기**
   - F12 → Console 탭 스크린샷
   - 어떤 문제인지 설명
   
2. **임시 해결책: 느린 입력**
   - 초성을 천천히 하나씩 입력
   - 각 입력 사이에 0.5초 정도 대기

3. **최후의 수단: 마우스 사용**
   - 확장 프로그램 없이 원래대로 사용
   - 또는 듀오링고 웹사이트 대신 앱 사용

## 📝 버전 정보

**v3 (현재 버전)**
- 다중 이벤트 리스너 (6개)
- `document_start`로 빠른 실행
- 강력한 이벤트 차단
- 상세한 디버깅 로그

이전 버전에서 키 입력이 안 되던 문제가 이번 버전에서 대폭 개선되었습니다! 🎉
